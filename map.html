<style>
    .container {
        display: flex;
        grid-template-columns: repeat;
        flex-direction: column;
        gap: 10px;
    }
    .card-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        padding: 20px;
    }
    .gauge-card {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        padding: 10px;
        text-align: center;
    }
    .gauge-container {
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .gauge {
        width: 100%;
        max-width: 200px;
        height: 120px;
    }
</style>

<div class="container">
    <div class="card-container">
        <div class="card gauge-card">
            <h3 style="font-size: 1.1rem; margin-bottom: 15px; color: #2c3e50;">風機轉速</h3>
            <div class="gauge-container">
                <svg width="100%" height="120" viewBox="0 0 200 120" class="gauge">
                    <defs>
                        <linearGradient id="gaugeGradient1" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#3498db;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#2980b9;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <path d="M40,100 A60,60 0 0,1 160,100" fill="none" stroke="#ecf0f1" stroke-width="20" />
                    <path
                            d="M40,100 A60,60 0 0,1 160,100"
                            fill="none"
                            stroke="url(#gaugeGradient1)"
                            stroke-width="20"
                            stroke-linecap="round"
                            stroke-dasharray="188.5, 188.5"
                            stroke-dashoffset="47.1"
                            class="gauge-fill"
                    />
                    <text x="100" y="80" text-anchor="middle" font-size="24" font-weight="600" fill="#2c3e50">1200</text>
                    <text x="100" y="105" text-anchor="middle" font-size="16" fill="#7f8c8d">RPM</text>
                </svg>
            </div>
        </div>
        <div class="card gauge-card">
            <h3 style="font-size: 1.1rem; margin-bottom: 15px; color: #2c3e50;">功率輸出</h3>
            <div class="gauge-container">
                <svg width="100%" height="120" viewBox="0 0 200 120" class="gauge">
                    <defs>
                        <linearGradient id="gaugeGradient2" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#f39c12;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#d35400;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <path d="M40,100 A60,60 0 0,1 160,100" fill="none" stroke="#ecf0f1" stroke-width="20" />
                    <path
                            d="M40,100 A60,60 0 0,1 160,100"
                            fill="none"
                            stroke="url(#gaugeGradient2)"
                            stroke-width="20"
                            stroke-linecap="round"
                            stroke-dasharray="188.5, 188.5"
                            stroke-dashoffset="56.5"
                            class="gauge-fill"
                    />
                    <text x="100" y="80" text-anchor="middle" font-size="24" font-weight="600" fill="#2c3e50">2.5</text>
                    <text x="100" y="105" text-anchor="middle" font-size="16" fill="#7f8c8d">MW</text>
                </svg>
            </div>
        </div>
        <div class="card gauge-card">
            <h3 style="font-size: 1.1rem; margin-bottom: 15px; color: #2c3e50;">葉片振動</h3>
            <div class="gauge-container">
                <svg width="100%" height="120" viewBox="0 0 200 120" class="gauge">
                    <defs>
                        <linearGradient id="gaugeGradient3" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#e74c3c;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#c0392b;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <path d="M40,100 A60,60 0 0,1 160,100" fill="none" stroke="#ecf0f1" stroke-width="20" />
                    <path
                            d="M40,100 A60,60 0 0,1 160,100"
                            fill="none"
                            stroke="url(#gaugeGradient3)"
                            stroke-width="20"
                            stroke-linecap="round"
                            stroke-dasharray="188.5, 188.5"
                            stroke-dashoffset="37.7"
                            class="gauge-fill"
                    />
                    <text x="100" y="80" text-anchor="middle" font-size="24" font-weight="600" fill="#2c3e50">0.8</text>
                    <text x="100" y="105" text-anchor="middle" font-size="16" fill="#7f8c8d">mm/s</text>
                </svg>
            </div>
        </div>
        <div class="card gauge-card">
            <h3 style="font-size: 1.1rem; margin-bottom: 15px; color: #2c3e50;">機艙溫度</h3>
            <div class="gauge-container">
                <svg width="100%" height="120" viewBox="0 0 200 120" class="gauge">
                    <defs>
                        <linearGradient id="gaugeGradient4" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#8e44ad;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#9b59b6;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <path d="M40,100 A60,60 0 0,1 160,100" fill="none" stroke="#ecf0f1" stroke-width="20" />
                    <path
                            d="M40,100 A60,60 0 0,1 160,100"
                            fill="none"
                            stroke="url(#gaugeGradient4)"
                            stroke-width="20"
                            stroke-linecap="round"
                            stroke-dasharray="188.5, 188.5"
                            stroke-dashoffset="62.8"
                            class="gauge-fill"
                    />
                    <text x="100" y="80" text-anchor="middle" font-size="24" font-weight="600" fill="#2c3e50">35.2</text>
                    <text x="100" y="105" text-anchor="middle" font-size="16" fill="#7f8c8d">°C</text>
                </svg>
            </div>
        </div>
    </div>
    <div id="map" style="height: 60vh;"></div>
</div>

<script>
    // 初始化地圖
    const map = L.map("map").setView([24.37, 120.58], 14);

    // 添加 OpenStreetMap 底圖
    L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
        attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
    }).addTo(map);

    // 風機資料點
    const turbines = [
        { lat: 25.063178, lon: 121.099614, id: "Unknown", count: 0, color: "black" },
        { lat: 25.059722, lon: 121.096915, id: 33, count: 0, color: "black" },
        { lat: 25.053779, lon: 121.086524, id: 36, count: 0, color: "black" },
        { lat: 25.051099, lon: 121.082825, id: 37, count: 0, color: "black" },
        { lat: 25.049386, lon: 121.080078, id: 72, count: 0, color: "black" },
        { lat: 25.047311, lon: 121.077173, id: 73, count: 0, color: "black" },
        { lat: 25.043361, lon: 121.06612, id: "Unknown", count: 0, color: "black" },
        { lat: 25.042342, lon: 121.063176, id: "Unknown", count: 0, color: "black" },
        { lat: 25.040665, lon: 121.058557, id: "Unknown", count: 0, color: "black" },
        { lat: 25.038752, lon: 121.05592, id: "Unknown", count: 0, color: "black" },
        { lat: 25.036749, lon: 121.052847, id: "Unknown", count: 0, color: "black" },
        { lat: 25.031605, lon: 121.046374, id: 30, count: 0, color: "black" },
        { lat: 25.021752, lon: 121.039039, id: "Unknown", count: 0, color: "black" },
        { lat: 25.020511, lon: 121.036382, id: 25, count: 0, color: "black" },
        { lat: 24.93468, lon: 120.982352, id: "Unknown", count: 0, color: "black" },
        { lat: 24.709631, lon: 120.863221, id: 8, count: 0, color: "red" },
        { lat: 24.705512, lon: 120.86121, id: 9, count: 20, color: "red" },
        { lat: 24.667418, lon: 120.817, id: "Unknown", count: 0, color: "black" },
        { lat: 24.591349, lon: 120.725205, id: "Unknown", count: 0, color: "black" },
        { lat: 24.574103, lon: 120.709082, id: 18, count: 21, color: "green" },
        { lat: 24.436903, lon: 120.621874, id: "Unknown", count: 20, color: "red" },
        { lat: 24.4223, lon: 120.613289, id: 24, count: 20, color: "red" },
        { lat: 24.417518, lon: 120.607851, id: "Unknown", count: 20, color: "red" },
        { lat: 24.411701, lon: 120.603579, id: 25, count: 0, color: "black" },
        { lat: 24.398728, lon: 120.597142, id: 34, count: 0, color: "black" },
        { lat: 24.398134, lon: 120.59464, id: 9, count: 0, color: "black" },
        { lat: 24.392628, lon: 120.588663, id: 27, count: 0, color: "black" },
        { lat: 24.370881, lon: 120.583292, id: 15, count: 9, color: "black" },
        { lat: 24.364251, lon: 120.579312, id: 16, count: 10, color: "red" },
        { lat: 24.355987, lon: 120.573084, id: 17, count: 10, color: "red" },
        { lat: 24.353799, lon: 120.570811, id: 18, count: 10, color: "red" },
        { lat: 24.322534, lon: 120.440806, id: 4, count: 20, color: "green" },
        { lat: 24.332534, lon: 120.440806, id: "08-01", count: 20, color: "green" },
        { lat: 24.342534, lon: 120.440806, id: "22a", count: 20, color: "green" },
        { lat: 23.985172, lon: 120.329242, id: "王功08", count: 10, color: "red" },
        { lat: 23.980975, lon: 120.327633, id: "王功09", count: 10, color: "red" },
        { lat: 23.589572, lon: 119.675862, id: "Unknown", count: 0, color: "black" },
    ];

    // 添加風機標記
    turbines.forEach((turbine) => {
        const icon = L.AwesomeMarkers.icon({
            icon: "info-sign",
            markerColor: turbine.color,
            prefix: "glyphicon",
            iconColor: "white",
        });

        const marker = L.marker([turbine.lat, turbine.lon]).addTo(map);
        const status =
            turbine.color === "black"
                ? "anomaly-windturbine.png"
                : "normal-windturbine.png";
        marker.setIcon(icon);
        marker.bindPopup(`
            <b>Wind Turbine ID:</b> ${turbine.id}<br>
            <b>Count:</b> ${turbine.count}<br>
            <img src="${status}" alt="Turbine Status" style="max-width: 500px; height: 200px;"><br>
        `);
    });

    // 自動調整地圖視圖以包含所有風機
    const bounds = L.latLngBounds(turbines.map((t) => [t.lat, t.lon]));
    map.fitBounds(bounds, { padding: [50, 50] });

    // 確保地圖大小正確
    setTimeout(() => {
        map.invalidateSize();
    }, 100);
</script>