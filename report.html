<style>
  .section {
    background: white;
    padding: 1rem;
    border-radius: 5px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    margin-bottom: 2rem;
  }
  .param-row {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
  }
  #chart-area canvas {
    width: 100% !important;
    max-width: 100%;
  }
  button {
    margin-right: 0.5rem;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
  }
  th, td {
    padding: 0.5rem 0.75rem;
    border: 1px solid #ccc;
    text-align: center;
  }
  th {
    background-color: #f0f0f0;
  }
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<p style="width: 100%; text-align: right; margin: -0.5rem 0 1rem; font-size: 0.9rem; color: #888;">
  <strong>â€» æŸ¥è©¢åƒ…é™å–®æ—¥è³‡æ–™ï¼Œé è¨­ç‚ºä»Šæ—¥ã€‚</strong>
</p>

<div class="section">
  <h2>ğŸ“… æŸ¥è©¢æ—¥æœŸ</h2>
  <label for="query-date">é¸æ“‡æ—¥æœŸï¼š</label>
  <input type="date" id="query-date">
  <button id="search">æŸ¥è©¢</button>
</div>

<div class="section">
  <h2>ğŸ“ˆ çµ±è¨ˆæŠ˜ç·šåœ–ï¼ˆå¤šåƒæ•¸æ¯”è¼ƒï¼‰</h2>
  <div class="param-row">
    <label><input type="checkbox" class="line-toggle" value="nox_out" checked> NOx å‡ºå£æ¿ƒåº¦ï¼ˆppmï¼‰</label>
    <label><input type="checkbox" class="line-toggle" value="nox_in" checked> NOx å…¥å£æ¿ƒåº¦ï¼ˆppmï¼‰</label>
    <label><input type="checkbox" class="line-toggle" value="nox_pred" checked> é æ¸¬ NOx æ¿ƒåº¦ï¼ˆppmï¼‰</label>
    <label><input type="checkbox" class="line-toggle" value="nh3"> æ³¨æ°¨æµé‡ï¼ˆNmÂ³/hï¼‰</label>
    <label><input type="checkbox" class="line-toggle" value="temp"> çˆè†›æº«åº¦ï¼ˆÂ°Cï¼‰</label>
    <label><input type="checkbox" class="line-toggle" value="flow"> ç…™æ°£æµé€Ÿï¼ˆm/sï¼‰</label>
  </div>
  <div class="param-row">
    <label for="granularity">è³‡æ–™ç²’åº¦ï¼š</label>
    <select id="granularity">
      <option value="minute">æ¯åˆ†é˜</option>
      <option value="hour">æ¯å°æ™‚</option>
    </select>
  </div>
  <canvas id="trendChart" height="120"></canvas>
</div>

<div class="section">
  <h2>ğŸ”” è¶…æ¨™è­¦å‘Šå€å¡Š</h2>
  <h3>ğŸ“‹ è¶…æ¨™äº‹ä»¶æ¸…å–®</h3>
  <table>
    <thead>
      <tr>
        <th>è­¦å‘Šç·¨è™Ÿ</th>
        <th>é–‹å§‹æ™‚é–“</th>
        <th>çµæŸæ™‚é–“</th>
        <th>æŒçºŒæ™‚é–“</th>
        <th>é¡å‹</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>A001</td><td>08:15</td><td>08:30</td><td>15 åˆ†é˜</td><td>ç¬é–“åé«˜</td></tr>
      <tr><td>A002</td><td>10:00</td><td>11:00</td><td>60 åˆ†é˜</td><td>é€£çºŒè¶…æ¨™</td></tr>
      <tr><td>A003</td><td>13:45</td><td>14:00</td><td>15 åˆ†é˜</td><td>ç¬é–“åé«˜</td></tr>
    </tbody>
  </table>
  <h3>ğŸ“Š çµ±è¨ˆæ‘˜è¦</h3>
  <table>
    <thead>
      <tr>
        <th>æŒ‡æ¨™é …ç›®</th>
        <th>æ•¸å€¼</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>ç¸½è¶…æ¨™æ¬¡æ•¸</td><td>3 æ¬¡</td></tr>
      <tr><td>é€£çºŒè¶…æ¨™æ¬¡æ•¸</td><td>1 æ¬¡</td></tr>
      <tr><td>ç•¶æ—¥ç¸½è¶…æ¨™æ™‚æ•¸</td><td>1 å°æ™‚ 30 åˆ†</td></tr>
    </tbody>
  </table>
</div>

<div class="section">
  <h2>âœ… æ¨¡å‹é æ¸¬æº–ç¢ºåº¦å€å¡Š</h2>
  <p>æ¨¡å‹ç‰ˆæœ¬ï¼šV1.0</p>
  <h3>ğŸ“Š é æ¸¬èª¤å·®è¡¨æ ¼</h3>
  <table>
    <thead>
      <tr>
        <th>æ™‚é–“</th>
        <th>å¯¦æ¸¬å€¼ (ppm)</th>
        <th>é æ¸¬å€¼ (ppm)</th>
        <th>åå·® (Î”)</th>
        <th>Ïƒ</th>
        <th>åˆ¤å®šç‹€æ…‹</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>00:00</td><td>15.2</td><td>15.3</td><td>+0.1</td><td>0.5</td><td>âœ… in Â±1Ïƒ</td></tr>
      <tr><td>01:00</td><td>14.9</td><td>15.8</td><td>+0.9</td><td>0.4</td><td>âŒ out Â±2Ïƒ</td></tr>
      <tr><td>02:00</td><td>15.0</td><td>15.5</td><td>+0.5</td><td>0.6</td><td>âš ï¸ in Â±2Ïƒ</td></tr>
      <tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr>
    </tbody>
  </table>
  <h3>ğŸ“ˆ æº–ç¢ºç‡æ‘˜è¦</h3>
  <table>
    <thead>
      <tr>
        <th>æŒ‡æ¨™é …ç›®</th>
        <th>æ•¸å€¼</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>Â±1Ïƒ å‘½ä¸­ç‡</td><td>87.5%</td></tr>
      <tr><td>Â±2Ïƒ å‘½ä¸­ç‡</td><td>97.8%</td></tr>
      <tr><td>æœ€å¤§èª¤å·®æ™‚æ®µ</td><td>01:00ï¼ˆåå·® +0.9 ppmï¼‰</td></tr>
    </tbody>
  </table>
</div>

<div class="section">
  <h2>ğŸ“¤ åŒ¯å‡ºåŠŸèƒ½</h2>
  <button id="exportCsv">åŒ¯å‡º CSV</button>
  <button id="exportPng">åŒ¯å‡ºåœ–è¡¨ç‚º PNG</button>
</div>

<script>
  // é è¨­æŸ¥è©¢æ—¥æœŸç‚ºä»Šæ—¥
  document.addEventListener('DOMContentLoaded', () => {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('query-date').value = today;
  });
    const ctx = document.getElementById('trendChart').getContext('2d');
  const timeLabels = ['08:00','09:00','10:00','11:00','12:00','13:00','14:00'];
  const mockData = {
    nox_out: [12, 16, 20, 14, 13, 18, 21],
    nox_in: [24, 28, 30, 26, 25, 29, 32],
    nox_pred: [13, 17, 19, 15, 14, 18, 20],
    nh3: [5, 7, 6, 4, 5, 6, 5],
    temp: [180, 185, 182, 178, 180, 183, 181],
    flow: [12.1, 12.3, 12.2, 12.0, 12.1, 12.4, 12.3]
  };
  const overThresholdIndices = [2, 6];

  const colorMap = {
    nox_out: '#e74c3c',
    nox_in: '#3498db',
    nox_pred: '#f39c12',
    nh3: '#27ae60',
    temp: '#8e44ad',
    flow: '#2c3e50'
  };

  const chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: timeLabels,
      datasets: Object.entries(mockData).map(([key, data]) => ({
        label: key,
        data: data,
        hidden: !['nox_out','nox_in','nox_pred'].includes(key),
        borderColor: colorMap[key],
        backgroundColor: colorMap[key] + '22',
        pointBackgroundColor: data.map((v, i) => key === 'nox_out' && overThresholdIndices.includes(i) ? '#e74c3c' : colorMap[key]),
        pointRadius: data.map((v, i) => key === 'nox_out' && overThresholdIndices.includes(i) ? 6 : 3),
        tension: 0.3
      }))
    },
    options: {
      responsive: true,
      interaction: { mode: 'index', intersect: false },
      plugins: {
        legend: { display: true },
        tooltip: {
          callbacks: {
            label: ctx => `${ctx.dataset.label}ï¼š${ctx.formattedValue}`
          }
        },
        title: { display: true, text: 'å¤šåƒæ•¸èµ°å‹¢åœ–ï¼ˆå«è¶…æ¨™æ¨™è¨˜ï¼‰' }
      },
      scales: {
        y: {
          title: { display: true, text: 'æ•¸å€¼' },
          grid: { borderDash: [4,4], color: '#ddd' }
        },
        x: {
          title: { display: true, text: 'æ™‚é–“' }
        }
      }
    }
  });

  document.querySelectorAll('.line-toggle').forEach(input => {
    input.addEventListener('change', e => {
      const dataset = chart.data.datasets.find(d => d.label === input.value);
      if (dataset) {
        dataset.hidden = !input.checked;
        chart.update();
      }
    });
  });
</script>